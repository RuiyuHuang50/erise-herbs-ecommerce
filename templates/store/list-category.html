{% extends 'base.html' %} {% load static %} {% block title %}{{ category.name }}
- Erise Herbs{% endblock %} {% block content %}
<!-- Category Header -->
<section
  style="
    background: linear-gradient(
      135deg,
      var(--primary-green),
      var(--secondary-green)
    );
    padding: 120px 0 80px;
    color: white;
    text-align: center;
  "
>
  <div class="container">
    <h1
      style="
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: white;
      "
    >
      {{ category.name }}
    </h1>
    <p
      style="font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto"
    >
      Discover our premium selection of {{ category.name|lower }} products,
      carefully sourced and scientifically formulated for optimal wellness
      benefits.
    </p>
  </div>
</section>

<!-- Products Grid -->
<section style="padding: 80px 0; background: var(--white)">
  <div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" style="margin-bottom: 2rem">
      <ol class="breadcrumb" style="background: none; padding: 0">
        <li class="breadcrumb-item">
          <a href="{% url 'store' %}" style="color: var(--primary-green)"
            >Home</a
          >
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          {{ category.name }}
        </li>
      </ol>
    </nav>

    <!-- Products Count -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 style="color: var(--dark-text); margin: 0">
        {{ products|length }} Product{{ products|length|pluralize }} Found
      </h2>

      <!-- Sort Options -->
      <div class="dropdown">
        <button
          class="btn btn-outline-success dropdown-toggle"
          type="button"
          data-bs-toggle="dropdown"
        >
          Sort By
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="?sort=name">Name A-Z</a></li>
          <li><a class="dropdown-item" href="?sort=-name">Name Z-A</a></li>
          <li>
            <a class="dropdown-item" href="?sort=price">Price Low-High</a>
          </li>
          <li>
            <a class="dropdown-item" href="?sort=-price">Price High-Low</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="product-grid">
      {% for product in products %}
      <div class="product-card">
        <div class="product-image">
          <a href="{{ product.get_absolute_url }}">
            <img
              src="{{ product.image.url }}"
              alt="{{ product.title }}"
              onerror="this.src='https://images.unsplash.com/photo-1607619056574-7b8d3ee536b2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'"
            />
          </a>
          <div class="product-badge">{{ product.category.name }}</div>

          <!-- Quick View Button -->
          <div style="position: absolute; top: 1rem; right: 1rem">
            <a
              href="{{ product.get_absolute_url }}"
              class="btn btn-sm btn-light"
              style="
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <i class="fas fa-eye"></i>
            </a>
          </div>
        </div>
        <div class="product-content">
          <h3 class="product-title">
            <a
              href="{{ product.get_absolute_url }}"
              style="text-decoration: none; color: inherit"
            >
              {{ product.title }}
            </a>
          </h3>
          <p class="product-brand">{{ product.brand }}</p>
          <p class="product-description">
            {{ product.description|truncatewords:12 }}
          </p>
          <div class="product-price">${{ product.price }}</div>

          <div class="d-flex gap-2">
            <form
              action="{% url 'cart-add' %}"
              method="POST"
              class="flex-grow-1"
            >
              {% csrf_token %}
              <input type="hidden" name="action" value="post" />
              <input type="hidden" name="product_id" value="{{ product.id }}" />
              <input type="hidden" name="product_quantity" value="1" />
              <button type="submit" class="add-to-cart">
                <i class="fas fa-cart-plus me-2"></i>Add to Cart
              </button>
            </form>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center" style="grid-column: 1 / -1">
        <div
          style="
            padding: 4rem 2rem;
            background: var(--cream);
            border-radius: 20px;
          "
        >
          <i
            class="fas fa-search"
            style="
              font-size: 4rem;
              color: var(--light-text);
              margin-bottom: 1rem;
            "
          ></i>
          <h3 style="color: var(--dark-text); margin-bottom: 1rem">
            No Products Found
          </h3>
          <p style="color: var(--light-text); margin-bottom: 2rem">
            We couldn't find any products in this category at the moment.
          </p>
          <a href="{% url 'store' %}" class="btn btn-primary"
            >Browse All Products</a
          >
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Load More Button (if needed for pagination) -->
    {% if products.has_next %}
    <div class="text-center mt-5">
      <a
        href="?page={{ products.next_page_number }}"
        class="btn btn-outline-success btn-lg"
      >
        Load More Products
      </a>
    </div>
    {% endif %}
  </div>
</section>

<!-- Related Categories -->
<section style="padding: 80px 0; background: var(--cream)">
  <div class="container">
    <h2 class="section-title">Explore Other Categories</h2>
    <div class="row">
      {% for cat in links %} {% if cat != category %}
      <div class="col-md-4 mb-4">
        <div class="feature-card" style="text-align: center">
          <div class="feature-icon">
            <i class="fas fa-leaf"></i>
          </div>
          <h4>{{ cat.name }}</h4>
          <p>Discover our {{ cat.name|lower }} collection</p>
          <a href="{{ cat.get_absolute_url }}" class="btn btn-outline-success"
            >Explore {{ cat.name }}</a
          >
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  // Add to cart with AJAX
  document.querySelectorAll(".add-to-cart").forEach((button) => {
    button.addEventListener("click", function (e) {
      e.preventDefault();

      const form = this.closest("form");
      if (!form) {
        console.error("Form not found");
        return;
      }

      const formData = new FormData(form);
      const originalText = this.innerHTML;
      const actionUrl = form.getAttribute("action");

      if (!actionUrl) {
        console.error("Form action not found");
        return;
      }

      this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Adding...';
      this.disabled = true;

      fetch(actionUrl, {
        method: "POST",
        body: formData,
        headers: {
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.qty) {
            // Update cart count in navigation if it exists
            const cartCount = document.querySelector(".cart-count");
            if (cartCount) {
              cartCount.textContent = data.qty;
            } else {
              // Create cart count if it doesn't exist
              const cartIcon = document.querySelector(".cart-icon");
              if (cartIcon && data.qty > 0) {
                cartIcon.innerHTML += `<span class="cart-count">${data.qty}</span>`;
              }
            }

            this.innerHTML = '<i class="fas fa-check me-2"></i>Added!';
            setTimeout(() => {
              this.innerHTML = originalText;
              this.disabled = false;
            }, 1000);
          } else {
            throw new Error("Invalid response");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          this.innerHTML =
            '<i class="fas fa-exclamation-triangle me-2"></i>Error';
          setTimeout(() => {
            this.innerHTML = originalText;
            this.disabled = false;
          }, 1000);
        });
    });
  });

  // Product card hover effects
  document.querySelectorAll(".product-card").forEach((card) => {
    card.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-10px)";
    });

    card.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0)";
    });
  });
</script>
{% endblock %}
